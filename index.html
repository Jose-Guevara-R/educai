<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Asistencia Escolar</title>
    
    <!-- Librerías y estilos -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="images/logo.png">
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4361ee',
                        secondary: '#3f37c9',
                        accent: '#4cc9f0',
                        success: '#4caf50',
                        warning: '#ff9800',
                        danger: '#f44336',
                        light: '#f8f9fa',
                        dark: '#343a40',
                        gray: '#6c757d',
                    }
                }
            }
        }
    </script>
    <!-- Librerías externas -->
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/2.29.3/date-fns.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/2.29.3/locale/es/index.min.js"></script>
</head>
<body class="bg-light text-dark">
    <!-- Barra de Navegación -->
    <nav class="bg-primary text-white shadow-lg fixed top-0 w-full z-10">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <a href="#home" class="font-bold text-xl nav-link">
                    <img src="images/logo.png" alt="Logo" class="inline-block h-8 w-8 mr-2 rounded-full">
                    <span class="hidden sm:inline">Sistema de Asistencia</span>
                </a>
                <div class="hidden md:flex nav-menu">
                    <a href="#scan" class="nav-link px-4 py-2 hover:bg-secondary rounded transition-colors">Escanear</a>
                    <a href="#manual-entry" class="nav-link px-4 py-2 hover:bg-secondary rounded transition-colors">Registro Manual</a>
                    <a href="#dashboard" class="nav-link px-4 py-2 hover:bg-secondary rounded transition-colors">Dashboard</a>
                    <a href="#report" class="nav-link px-4 py-2 hover:bg-secondary rounded transition-colors">Reportes</a>
                </div>
                <div class="md:hidden">
                    <button class="nav-toggle focus:outline-none">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </button>
                </div>
            </div>
        </div>
        <div class="md:hidden nav-menu-mobile">
            <a href="#scan" class="nav-link block px-4 py-2 hover:bg-secondary transition-colors">Escanear</a>
            <a href="#manual-entry" class="nav-link block px-4 py-2 hover:bg-secondary transition-colors">Registro Manual</a>
            <a href="#dashboard" class="nav-link block px-4 py-2 hover:bg-secondary transition-colors">Dashboard</a>
            <a href="#report" class="nav-link block px-4 py-2 hover:bg-secondary transition-colors">Reportes</a>
        </div>
    </nav>
    
    <main class="pt-20 pb-8 container mx-auto px-4">
        <!-- Página de Inicio -->
        <section id="home" class="page active">
            <div class="flex items-center justify-center min-h-[calc(100vh-8rem)]">
                <div class="text-center">
                    <img src="images/logo.png" alt="Logo grande" class="mx-auto w-32 h-32 mb-6">
                    <h1 class="text-4xl font-bold text-primary mb-4">¡Bienvenido al Sistema de Asistencia!</h1>
                    <p class="text-lg text-gray-700 max-w-2xl mx-auto">
                        Selecciona una opción del menú de navegación para empezar.
                    </p>
                </div>
            </div>
        </section>

        <!-- Página de Escaneo -->
        <section id="scan" class="page hidden">
            <h2 class="text-3xl font-bold text-center text-primary mb-6">Escanear Código QR</h2>
            <div class="bg-white p-6 rounded-lg shadow-xl max-w-xl mx-auto">
                <div id="qr-reader" class="w-full"></div>
                <div id="scan-result" class="mt-4 text-center"></div>
            </div>
        </section>
        
        <!-- Página de Registro Manual -->
        <section id="manual-entry" class="page hidden">
            <h2 class="text-3xl font-bold text-center text-primary mb-6">Registro de Asistencia Manual</h2>
            <div class="bg-white p-6 rounded-lg shadow-xl max-w-xl mx-auto">
                <form id="manual-form">
                    <div class="mb-4">
                        <label for="manual-dni" class="block text-gray-700 font-bold mb-2">DNI del Estudiante:</label>
                        <input type="text" id="manual-dni" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="Ingresa DNI">
                    </div>
                    <button type="submit" class="w-full bg-primary text-white font-bold py-2 px-4 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50">
                        Registrar Asistencia
                    </button>
                </form>
                <div id="manual-result" class="mt-4"></div>
            </div>
        </section>

        <!-- Página de Dashboard -->
        <section id="dashboard" class="page hidden">
            <h2 class="text-3xl font-bold text-center text-primary mb-6">Dashboard de Asistencia</h2>
            <div class="bg-white p-6 rounded-lg shadow-xl max-w-3xl mx-auto">
                <div class="mb-4 flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4">
                    <div class="flex-grow w-full md:w-auto">
                        <label for="dashboard-date" class="block text-gray-700 font-bold mb-2">Selecciona una fecha:</label>
                        <input type="date" id="dashboard-date" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                    <button id="load-dashboard" class="mt-auto w-full md:w-auto bg-primary text-white font-bold py-2 px-4 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50">
                        Cargar Datos
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                    <div class="bg-gray-100 p-4 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-4">Resumen Diario</h3>
                        <div class="w-full h-64">
                            <canvas id="attendance-chart"></canvas>
                        </div>
                    </div>
                    <div id="late-absent-list" class="bg-gray-100 p-4 rounded-lg shadow-md overflow-x-auto">
                        <p class="text-center text-gray-500">Selecciona una fecha y haz clic en 'Cargar Datos'.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Página de Reportes -->
        <section id="report" class="page hidden">
            <h2 class="text-3xl font-bold text-center text-primary mb-6">Generar Reportes</h2>
            <div class="bg-white p-6 rounded-lg shadow-xl max-w-xl mx-auto">
                <div class="mb-4">
                    <label for="report-grade" class="block text-gray-700 font-bold mb-2">Filtrar por Grado:</label>
                    <select id="report-grade" class="shadow border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                        <option value="">Todos los Grados</option>
                        <option value="1">1ro</option>
                        <option value="2">2do</option>
                        <option value="3">3ro</option>
                        <option value="4">4to</option>
                        <option value="5">5to</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="report-section" class="block text-gray-700 font-bold mb-2">Filtrar por Sección:</label>
                    <select id="report-section" class="shadow border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                        <option value="">Todas las Secciones</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="report-date" class="block text-gray-700 font-bold mb-2">Filtrar por Fecha:</label>
                    <input type="date" id="report-date" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <button id="generate-report" class="w-full bg-primary text-white font-bold py-2 px-4 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50">
                    Generar Reporte
                </button>
                <div id="report-result" class="mt-4"></div>
            </div>
        </section>
    </main>
    
    <!-- Modal -->
    <div id="modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <div id="modal-icon" class="mx-auto flex items-center justify-center h-12 w-12 rounded-full">
                    <!-- Icono dinámico -->
                    <svg id="modal-success-icon" class="h-6 w-6 text-success hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                    <svg id="modal-error-icon" class="h-6 w-6 text-danger hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    <svg id="modal-warning-icon" class="h-6 w-6 text-warning hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.5-1.25 2.22-2.79L15.22 5.21c-.28-1.54-1.64-2.21-3.08-1.42L5.862 7.79c-1.44.79-1.44 2.05 0 2.84l4.28 2.34c1.44.79 3.08.79 4.52 0l4.28-2.34c1.44-.79 1.44-2.05 0-2.84L12 5.79c-1.44-.79-3.08-.79-4.52 0L3.722 8.58c-1.44.79-1.44 2.05 0 2.84l4.28 2.34c1.44.79 3.08.79 4.52 0L20.28 8.58c1.44-.79 1.44-2.05 0-2.84L12 3.42z" /></svg>
                </div>
                <h3 id="modal-title" class="text-lg leading-6 font-medium text-gray-900 mt-2">Mensaje</h3>
                <div class="mt-2 px-7 py-3">
                    <p id="modal-message" class="text-sm text-gray-500">
                        Este es un mensaje de ejemplo.
                    </p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="modal-close-btn" class="px-4 py-2 bg-primary text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-secondary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/qr-scanner.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').then(function(reg) {
                console.log('Service Worker registrado con éxito en el scope', reg.scope);
            }).catch(function(err) {
                console.log('Fallo el registro del Service Worker. Error:', err);
            });
        }
    </script>
</body>
</html>
